{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Operational Network Topology",
  "allOf": [
    {
      "$id": "schema_operational_merged.json",
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "title": "IETF Network + Topology + L2/L3 (RFC 8345/8346/8944) â€” YAML/JSON instance schema",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "ietf-network:networks": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "network": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/network"
              }
            }
          },
          "required": [
            "network"
          ]
        }
      },
      "required": [
        "ietf-network:networks"
      ],
      "$defs": {
        "idString": {
          "type": "string",
          "minLength": 1
        },
        "ipv4": {
          "type": "string",
          "format": "ipv4"
        },
        "ipv6": {
          "type": "string",
          "format": "ipv6"
        },
        "ip": {
          "oneOf": [
            {
              "$ref": "#/$defs/ipv4"
            },
            {
              "$ref": "#/$defs/ipv6"
            }
          ]
        },
        "mac": {
          "type": "string",
          "pattern": "^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$"
        },
        "vlanId": {
          "type": "integer",
          "minimum": 1,
          "maximum": 4094
        },
        "vni": {
          "type": "integer",
          "minimum": 1,
          "maximum": 16777214
        },
        "presenceContainer": {
          "type": "object",
          "additionalProperties": false,
          "maxProperties": 0,
          "description": "YANG presence container (no members; presence means enabled)."
        },
        "identityref_iana_if_type": {
          "type": "string",
          "description": "identityref base=iana-interface-type; prefix:name",
          "pattern": "^iana-if-type:[A-Za-z_][A-Za-z0-9_\\-]*$",
          "anyOf": [
            {
              "enum": [
                "iana-if-type:ethernetCsmacd",
                "iana-if-type:softwareLoopback",
                "iana-if-type:ppp",
                "iana-if-type:slip",
                "iana-if-type:atm",
                "iana-if-type:frameRelay",
                "iana-if-type:sonet",
                "iana-if-type:fddi",
                "iana-if-type:rs232",
                "iana-if-type:ds1",
                "iana-if-type:ds3",
                "iana-if-type:tunnel",
                "iana-if-type:other"
              ]
            }
          ]
        },
        "network": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "network-id": {
              "$ref": "#/$defs/idString"
            },
            "ietf-network:network-types": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "ietf-l3-unicast-topology:l3-unicast-topology": {
                  "$ref": "#/$defs/presenceContainer"
                },
                "ietf-l2-topology:l2-topology": {
                  "$ref": "#/$defs/presenceContainer"
                }
              }
            },
            "ietf-network:supporting-network": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "network-ref": {
                    "type": "string",
                    "x-leafref": "/ietf-network:networks/network/network-id",
                    "$comment": "leafref -> /networks/network/network-id"
                  }
                },
                "required": [
                  "network-ref"
                ]
              }
            },
            "ietf-l3-unicast-topology:l3-topology-attributes": {
              "type": "object",
              "additionalProperties": true
            },
            "ietf-l2-topology:l2-network-attributes": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "name": {
                  "type": "string"
                },
                "flags": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "node": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/node"
              }
            },
            "ietf-network-topology:link": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/link"
              }
            }
          },
          "required": [
            "network-id"
          ]
        },
        "node": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "node-id": {
              "$ref": "#/$defs/idString"
            },
            "ietf-network:supporting-node": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "network-ref": {
                    "type": "string",
                    "x-leafref": "/ietf-network:networks/network/network-id"
                  },
                  "node-ref": {
                    "type": "string",
                    "x-leafref": "/ietf-network:networks/network[node/network/node-id]/node/node-id",
                    "$comment": "leafref -> target network's node/node-id"
                  }
                },
                "required": [
                  "network-ref",
                  "node-ref"
                ]
              }
            },
            "ietf-l3-unicast-topology:l3-node-attributes": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "name": {
                  "type": "string"
                },
                "flags": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "ietf-l2-topology:l2-node-attributes": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "l2-node-id": {
                  "type": "string"
                },
                "management-address": {
                  "$ref": "#/$defs/ip"
                },
                "management-mac-address": {
                  "$ref": "#/$defs/mac"
                },
                "management-vlan": {
                  "$ref": "#/$defs/vlanId"
                },
                "flags": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "ietf-network-topology:termination-point": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/tp",
                "properties": {
                  "operational:tp-state": {
                    "type": "object",
                    "additionalProperties": true,
                    "properties": {
                      "admin-status": {
                        "type": "string",
                        "enum": [
                          "up",
                          "down",
                          "testing"
                        ]
                      },
                      "oper-status": {
                        "type": "string",
                        "enum": [
                          "up",
                          "down",
                          "unknown"
                        ]
                      },
                      "speed-bps": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "duplex": {
                        "type": "string",
                        "enum": [
                          "full",
                          "half",
                          "unknown"
                        ]
                      },
                      "mtu": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "last-change": {
                        "type": "string",
                        "format": "date-time"
                      }
                    }
                  }
                }
              }
            }
          },
          "required": [
            "node-id"
          ]
        },
        "tp": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "tp-id": {
              "$ref": "#/$defs/idString"
            },
            "ietf-network-topology:supporting-termination-point": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "network-ref": {
                    "type": "string",
                    "x-leafref": "/ietf-network:networks/network/network-id"
                  },
                  "node-ref": {
                    "type": "string",
                    "x-leafref": "/ietf-network:networks/network[node/node-id]/node/node-id"
                  },
                  "tp-ref": {
                    "type": "string",
                    "x-leafref": "/ietf-network:networks/network[node/termination-point/tp-id]/node/termination-point/tp-id"
                  }
                },
                "required": [
                  "network-ref",
                  "node-ref",
                  "tp-ref"
                ]
              }
            },
            "ietf-l3-unicast-topology:l3-termination-point-attributes": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "ip-address": {
                  "$ref": "#/$defs/ip"
                },
                "prefix-length": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 128
                },
                "flags": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "ietf-l2-topology:l2-termination-point-attributes": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "interface-name": {
                  "type": "string"
                },
                "encapsulation": {
                  "$ref": "#/$defs/identityref_iana_if_type"
                },
                "lag": {
                  "type": "boolean"
                },
                "member-link-tp": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "x-leafref": "/ietf-network:networks/network/node/ietf-network-topology:termination-point/tp-id"
                  }
                },
                "mac-address": {
                  "$ref": "#/$defs/mac"
                },
                "vlan-id": {
                  "$ref": "#/$defs/vlanId"
                },
                "qinq": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "outer": {
                        "$ref": "#/$defs/vlanId"
                      },
                      "inner": {
                        "$ref": "#/$defs/vlanId"
                      }
                    },
                    "required": [
                      "outer",
                      "inner"
                    ]
                  }
                },
                "vxlan-vni": {
                  "$ref": "#/$defs/vni"
                },
                "flags": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "operational:lag-state": {
                  "type": "object",
                  "additionalProperties": true,
                  "properties": {
                    "aggregate-oper-status": {
                      "type": "string"
                    },
                    "lacp": {
                      "type": "object",
                      "additionalProperties": true,
                      "properties": {
                        "actor-state": {
                          "type": "string"
                        },
                        "partner-state": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            },
            "operational:tp-state": {
              "type": "object",
              "additionalProperties": true,
              "properties": {
                "admin-status": {
                  "type": "string",
                  "enum": [
                    "up",
                    "down",
                    "testing"
                  ]
                },
                "oper-status": {
                  "type": "string",
                  "enum": [
                    "up",
                    "down",
                    "unknown"
                  ]
                },
                "speed-bps": {
                  "type": "integer",
                  "minimum": 0
                },
                "duplex": {
                  "type": "string",
                  "enum": [
                    "full",
                    "half",
                    "unknown"
                  ]
                },
                "mtu": {
                  "type": "integer",
                  "minimum": 0
                },
                "last-change": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          },
          "required": [
            "tp-id"
          ]
        },
        "link": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "link-id": {
              "$ref": "#/$defs/idString"
            },
            "ietf-network-topology:source": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "source-node": {
                  "type": "string",
                  "x-leafref": "/ietf-network:networks/network/node/node-id"
                },
                "source-tp": {
                  "type": "string",
                  "x-leafref": "/ietf-network:networks/network/node/ietf-network-topology:termination-point/tp-id"
                }
              },
              "required": [
                "source-node",
                "source-tp"
              ]
            },
            "ietf-network-topology:destination": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "dest-node": {
                  "type": "string",
                  "x-leafref": "/ietf-network:networks/network/node/node-id"
                },
                "dest-tp": {
                  "type": "string",
                  "x-leafref": "/ietf-network:networks/network/node/ietf-network-topology:termination-point/tp-id"
                }
              },
              "required": [
                "dest-node",
                "dest-tp"
              ]
            },
            "ietf-network-topology:supporting-link": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "network-ref": {
                    "type": "string",
                    "x-leafref": "/ietf-network:networks/network/network-id"
                  },
                  "link-ref": {
                    "type": "string",
                    "x-leafref": "/ietf-network:networks/network/ietf-network-topology:link/link-id"
                  }
                },
                "required": [
                  "network-ref",
                  "link-ref"
                ]
              }
            },
            "ietf-l3-unicast-topology:l3-link-attributes": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "metric": {
                  "type": "integer",
                  "minimum": 0
                },
                "bandwidth": {
                  "type": "integer",
                  "minimum": 0
                },
                "flags": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "ietf-l2-topology:l2-link-attributes": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "name": {
                  "type": "string"
                },
                "encapsulation": {
                  "$ref": "#/$defs/identityref_iana_if_type"
                },
                "switching-capability": {
                  "type": "string"
                },
                "vlan-id": {
                  "$ref": "#/$defs/vlanId"
                },
                "qinq": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "outer": {
                        "$ref": "#/$defs/vlanId"
                      },
                      "inner": {
                        "$ref": "#/$defs/vlanId"
                      }
                    },
                    "required": [
                      "outer",
                      "inner"
                    ]
                  }
                },
                "vxlan-vni": {
                  "$ref": "#/$defs/vni"
                },
                "flags": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "operational:link-state": {
              "type": "object",
              "additionalProperties": true,
              "properties": {
                "oper-status": {
                  "type": "string"
                },
                "bw-available-bps": {
                  "type": "integer",
                  "minimum": 0
                },
                "latency-ms": {
                  "type": "number",
                  "minimum": 0
                },
                "loss-ppm": {
                  "type": "number",
                  "minimum": 0
                },
                "last-change": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          },
          "required": [
            "link-id",
            "ietf-network-topology:source",
            "ietf-network-topology:destination"
          ]
        }
      }
    }
  ],
  "properties": {
    "ietf-network:networks": {
      "type": "object",
      "properties": {
        "network": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "node": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "ietf-network-topology:termination-point": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "operational:tp-state": {
                            "type": "object",
                            "properties": {
                              "admin-status": {
                                "type": "string"
                              },
                              "oper-status": {
                                "type": "string"
                              },
                              "speed-bps": {
                                "type": "integer"
                              },
                              "duplex": {
                                "type": "string"
                              },
                              "mtu": {
                                "type": "integer"
                              },
                              "last-change": {
                                "type": "string",
                                "format": "date-time"
                              }
                            },
                            "additionalProperties": false
                          }
                        },
                        "required": [
                          "tp-id"
                        ],
                        "additionalProperties": true
                      }
                    }
                  },
                  "additionalProperties": true
                }
              },
              "ietf-network-topology:link": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "operational:link-state": {
                      "type": "object",
                      "properties": {
                        "admin-status": {
                          "type": "string"
                        },
                        "oper-status": {
                          "type": "string"
                        },
                        "bandwidth": {
                          "type": "integer"
                        },
                        "delay-ms": {
                          "type": "number"
                        },
                        "last-change": {
                          "type": "string",
                          "format": "date-time"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": true
                }
              }
            },
            "additionalProperties": true
          }
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}